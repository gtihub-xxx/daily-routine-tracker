<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³è¨˜éŒ²ã‚¢ãƒ—ãƒª v2.8.0</title>
    <style>
        /* ========================================
           CSS Variables & Reset
        ======================================== */
        :root {
            --primary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff6b6b;
            --text-primary: #333;
            --text-secondary: #666;
            --border-light: #ddd;
            --background-light: #f8f9fa;
            --background-white: #ffffff;
            --border-radius: 8px;
            --border-radius-large: 15px;
            --shadow: 0 10px 30px rgba(0,0,0,0.2);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ========================================
           Base Styles
        ======================================== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent; /* ã‚¹ãƒãƒ›ç”¨ã‚¿ãƒƒãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆå‰Šé™¤ */
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: var(--background-white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* ========================================
           Header Styles
        ======================================== */
        .header {
            background: var(--primary-gradient);
            color: var(--background-white);
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .version-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .date {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ========================================
           Navigation Styles
        ======================================== */
        .nav-tabs {
            display: flex;
            background: var(--background-light);
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            color: var(--text-secondary);
            -webkit-user-select: none;
            user-select: none;
        }

        .nav-tab.active {
            background: var(--background-white);
            color: #4facfe;
            font-weight: bold;
        }

        /* ========================================
           Content & Section Styles
        ======================================== */
        .content {
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .routine-section {
            margin-bottom: 25px;
            background: var(--background-light);
            border-radius: var(--border-radius-large);
            padding: 20px;
            position: relative;
        }

        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .section-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .streak-badge {
            background: linear-gradient(135deg, var(--warning-color), #feca57);
            color: var(--background-white);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ========================================
           Form Elements
        ======================================== */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none; /* iOSç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«å‰Šé™¤ */
        }

        .input-field:focus {
            outline: none;
            border-color: #4facfe;
        }

        .textarea-field {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 12px;
            min-height: 60px;
            resize: vertical;
            font-family: inherit;
            margin-top: 8px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }

        .textarea-field:focus {
            outline: none;
            border-color: #4facfe;
        }

        /* ========================================
           Button Styles
        ======================================== */
        .btn-primary {
            width: 100%;
            padding: 15px;
            background: var(--primary-gradient);
            color: var(--background-white);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            -webkit-user-select: none;
            user-select: none;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .btn-secondary {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: #6c757d;
            color: var(--background-white);
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            -webkit-user-select: none;
            user-select: none;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }

        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Button Color Variants */
        .btn-exercise { background: #ff6b6b; }
        .btn-massage { background: #4ecdc4; }
        .btn-study { background: #45b7d1; }
        .btn-reading { background: #96ceb4; }
        .btn-spending { background: #f39c12; }
        .btn-export { background: #28a745; }
        .btn-import { background: #007bff; }
        .btn-clear { background: var(--error-color); }

        /* ========================================
           Checkbox & Interactive Elements
        ======================================== */
        .checkbox-item {
            display: flex;
            align-items: center;
            background: var(--background-white);
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            min-width: 120px;
            -webkit-user-select: none;
            user-select: none;
        }

        .checkbox-item.checked {
            background: #e8f5e8;
            border-color: var(--success-color);
        }

        .checkbox-item input {
            margin-right: 8px;
        }

        .study-item {
            margin-bottom: 20px;
            background: var(--background-white);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }

        .study-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-primary);
            transition: color 0.3s;
            -webkit-user-select: none;
            user-select: none;
        }

        .study-checkbox input {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .study-checkbox.checked {
            color: var(--success-color);
        }

        /* ========================================
           Spending Styles
        ======================================== */
        .spending-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .spending-item {
            background: var(--background-white);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }

        .spending-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-primary);
            transition: color 0.3s;
            -webkit-user-select: none;
            user-select: none;
        }

        .spending-checkbox input {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .spending-checkbox.checked {
            color: #f39c12;
        }

        .spending-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .spending-amount {
            flex: 1;
            padding: 8px 12px;
            font-size: 14px;
        }

        .currency {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: bold;
            min-width: 20px;
        }

        .spending-total {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .spending-total-label {
            font-size: 14px;
            color: #856404;
            margin-bottom: 5px;
        }

        .spending-total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #f39c12;
        }

        /* ========================================
           Statistics & Totals
        ======================================== */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--background-light);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4facfe;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .exercise-totals,
        .other-totals,
        .study-totals,
        .spending-totals {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .exercise-total-item,
        .other-total-item,
        .study-total-item,
        .spending-total-item {
            display: flex;
            align-items: center;
            background: var(--background-white);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            transition: var(--transition);
        }

        .exercise-total-item:hover,
        .other-total-item:hover,
        .study-total-item:hover,
        .spending-total-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .exercise-icon,
        .other-icon,
        .study-icon,
        .spending-icon {
            font-size: 20px;
            margin-right: 15px;
            min-width: 25px;
            text-align: center;
        }

        .exercise-icon {
            font-size: 24px;
            min-width: 30px;
        }

        .exercise-info,
        .other-info,
        .study-info,
        .spending-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-name,
        .other-name,
        .study-name,
        .spending-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .exercise-name {
            font-size: 16px;
        }

        .exercise-count,
        .other-count,
        .study-count,
        .spending-count {
            font-size: 16px;
            font-weight: bold;
            color: #4facfe;
        }

        .exercise-count {
            font-size: 18px;
        }

        .study-count {
            color: #45b7d1;
        }

        .spending-count {
            color: #f39c12;
        }

        /* Sum Variants */
        .exercise-total-sum,
        .study-total-sum,
        .spending-total-sum {
            font-weight: bold;
            color: var(--background-white);
            border: none;
        }

        .exercise-total-sum {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
        }

        .study-total-sum {
            background: linear-gradient(135deg, #45b7d1, #96ceb4);
        }

        .spending-total-sum {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .exercise-total-sum .exercise-name,
        .exercise-total-sum .exercise-count,
        .study-total-sum .study-name,
        .study-total-sum .study-count,
        .spending-total-sum .spending-name,
        .spending-total-sum .spending-count {
            color: var(--background-white);
        }

        .exercise-total-sum .exercise-count {
            font-size: 20px;
        }

        .study-total-sum .study-count {
            font-size: 18px;
        }

        .spending-total-sum .spending-count {
            font-size: 18px;
        }

        /* ========================================
           Period Tabs
        ======================================== */
        .period-tabs {
            display: flex;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 15px;
            gap: 2px;
        }

        .period-tab {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            -webkit-user-select: none;
            user-select: none;
        }

        .period-tab.active {
            background: var(--background-white);
            color: #4facfe;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .period-tab:hover:not(.active) {
            background: rgba(255,255,255,0.5);
        }

        .period-info {
            background: #e8f4fd;
            color: #2c5aa0;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* ========================================
           Calendar
        ======================================== */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            font-size: 12px;
            font-weight: bold;
        }

        .calendar-header {
            background: #667eea;
            color: var(--background-white);
        }

        .calendar-date {
            background: #f0f0f0;
            color: #999;
        }

        .calendar-date.completed {
            background: var(--success-color);
            color: var(--background-white);
        }

        .calendar-date.today {
            background: #2196f3;
            color: var(--background-white);
        }

        /* ========================================
           Settings
        ======================================== */
        .settings-section {
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .time-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .notification-times {
            padding: 10px;
            background: var(--background-light);
            border-radius: 10px;
            margin-top: 10px;
        }

        .notification-times .input-group {
            margin-bottom: 15px;
        }

        .notification-times .input-group:last-child {
            margin-bottom: 0;
        }

        .file-input {
            display: none;
        }

        .app-info {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 20px;
            padding: 15px;
            background: var(--background-light);
            border-radius: 10px;
        }

        .storage-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .status-indicator.error {
            background: var(--error-color);
        }

        .memo-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .spending-summary {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .spending-summary-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .summary-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .summary-value {
            font-size: 14px;
            font-weight: bold;
            color: #f39c12;
        }

        /* ========================================
           Toast & Loading States
        ======================================== */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: var(--background-white);
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            display: none;
            transition: var(--transition);
        }

        .toast.error {
            background: var(--error-color);
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* ========================================
           Responsive Design
        ======================================== */
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 15px;
            }
            
            .routine-section {
                padding: 15px;
            }
        }

        @media (max-width: 350px) {
            .summary-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="app-container">
        <div class="header">
            <div class="version-badge">v2.8.0</div>
            <div class="date" id="current-date"></div>
            <div class="subtitle">ä»Šæ—¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</div>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="record">è¨˜éŒ²</button>
            <button class="nav-tab" data-tab="history">å±¥æ­´</button>
            <button class="nav-tab" data-tab="settings">è¨­å®š</button>
        </nav>

        <div class="content">
            <!-- è¨˜éŒ²ã‚¿ãƒ– -->
            <section class="section active" id="record">
                <!-- é‹å‹•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ’ª é‹å‹•</span>
                        <span class="streak-badge" id="exercise-streak">0æ—¥ç¶™ç¶š</span>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="pushups">è…•ç«‹ã¦ä¼ã›ï¼ˆå›ï¼‰</label>
                        <input type="number" class="input-field" id="pushups" placeholder="å›æ•°ã‚’å…¥åŠ›" min="0" max="9999">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="situps">è…¹ç­‹ï¼ˆå›ï¼‰</label>
                        <input type="number" class="input-field" id="situps" placeholder="å›æ•°ã‚’å…¥åŠ›" min="0" max="9999">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="squats">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆï¼ˆå›ï¼‰</label>
                        <input type="number" class="input-field" id="squats" placeholder="å›æ•°ã‚’å…¥åŠ›" min="0" max="9999">
                    </div>
                    <button class="btn-secondary btn-exercise" id="save-exercise-btn">ğŸ’ª é‹å‹•ã‚’è¨˜éŒ²</button>
                </div>

                <!-- ãƒãƒƒã‚µãƒ¼ã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ«§ ãƒãƒƒã‚µãƒ¼ã‚¸</span>
                        <span class="streak-badge" id="massage-streak">0æ—¥ç¶™ç¶š</span>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="massage-time">ãƒãƒƒã‚µãƒ¼ã‚¸æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                        <input type="number" class="input-field" id="massage-time" placeholder="æ™‚é–“ã‚’å…¥åŠ›" min="0" max="999">
                    </div>
                    <button class="btn-secondary btn-massage" id="save-massage-btn">ğŸ«§ ãƒãƒƒã‚µãƒ¼ã‚¸ã‚’è¨˜éŒ²</button>
                </div>

                <!-- å‹‰å¼·ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ“š å‹‰å¼·</span>
                        <span class="streak-badge" id="study-streak">0æ—¥ç¶™ç¶š</span>
                    </div>
                    
                    <div class="study-item">
                        <div class="study-item-header" data-subject="english">
                            <label class="study-checkbox">
                                <input type="checkbox" id="english">
                                <span>ğŸ‡ºğŸ‡¸ è‹±èª</span>
                            </label>
                        </div>
                        <div class="memo-label">ğŸ“ ãƒ¡ãƒ¢ãƒ»ç†è§£ã—ãŸã“ã¨</div>
                        <textarea class="textarea-field" id="english-memo" placeholder="è‹±èªã®å­¦ç¿’å†…å®¹ã‚„ç†è§£ã—ãŸã“ã¨ã‚’è¨˜éŒ²" maxlength="1000"></textarea>
                    </div>

                    <div class="study-item">
                        <div class="study-item-header" data-subject="bookkeeping">
                            <label class="study-checkbox">
                                <input type="checkbox" id="bookkeeping">
                                <span>ğŸ“Š ç°¿è¨˜</span>
                            </label>
                        </div>
                        <div class="memo-label">ğŸ“ ãƒ¡ãƒ¢ãƒ»ç†è§£ã—ãŸã“ã¨</div>
                        <textarea class="textarea-field" id="bookkeeping-memo" placeholder="ç°¿è¨˜ã®å­¦ç¿’å†…å®¹ã‚„ç†è§£ã—ãŸã“ã¨ã‚’è¨˜éŒ²" maxlength="1000"></textarea>
                    </div>

                    <div class="study-item">
                        <div class="study-item-header" data-subject="fp">
                            <label class="study-checkbox">
                                <input type="checkbox" id="fp">
                                <span>ğŸ’° ãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚·ãƒ£ãƒ«ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</span>
                            </label>
                        </div>
                        <div class="memo-label">ğŸ“ ãƒ¡ãƒ¢ãƒ»ç†è§£ã—ãŸã“ã¨</div>
                        <textarea class="textarea-field" id="fp-memo" placeholder="FPã®å­¦ç¿’å†…å®¹ã‚„ç†è§£ã—ãŸã“ã¨ã‚’è¨˜éŒ²" maxlength="1000"></textarea>
                    </div>

                    <div class="study-item">
                        <div class="study-item-header" data-subject="ai">
                            <label class="study-checkbox">
                                <input type="checkbox" id="ai">
                                <span>ğŸ¤– AI</span>
                            </label>
                        </div>
                        <div class="memo-label">ğŸ“ ãƒ¡ãƒ¢ãƒ»ç†è§£ã—ãŸã“ã¨</div>
                        <textarea class="textarea-field" id="ai-memo" placeholder="AIã®å­¦ç¿’å†…å®¹ã‚„ç†è§£ã—ãŸã“ã¨ã‚’è¨˜éŒ²" maxlength="1000"></textarea>
                    </div>
                    
                    <button class="btn-secondary btn-study" id="save-study-btn">ğŸ“š å‹‰å¼·ã‚’è¨˜éŒ²</button>
                </div>

                <!-- èª­æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ“– èª­æ›¸</span>
                        <span class="streak-badge" id="reading-streak">0æ—¥ç¶™ç¶š</span>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="reading-time">èª­æ›¸æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                        <input type="number" class="input-field" id="reading-time" placeholder="æ™‚é–“ã‚’å…¥åŠ›" min="0" max="999">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="book-title">æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" class="input-field" id="book-title" placeholder="æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«" maxlength="100">
                    </div>
                    <button class="btn-secondary btn-reading" id="save-reading-btn">ğŸ“– èª­æ›¸ã‚’è¨˜éŒ²</button>
                </div>

                <!-- å—œå¥½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">â˜• å—œå¥½å“ã¸ã®å‡ºè²»</span>
                        <span class="streak-badge" id="spending-streak">0æ—¥ç¶™ç¶š</span>
                    </div>
                    
                    <div class="spending-items">
                        <div class="spending-item">
                            <div class="spending-header" data-item="coffee">
                                <label class="spending-checkbox">
                                    <input type="checkbox" id="coffee">
                                    <span>â˜• ã‚³ãƒ¼ãƒ’ãƒ¼</span>
                                </label>
                            </div>
                            <div class="spending-input">
                                <input type="number" class="input-field spending-amount" id="coffee-amount" placeholder="é‡‘é¡" min="0" max="99999">
                                <span class="currency">å††</span>
                            </div>
                        </div>

                        <div class="spending-item">
                            <div class="spending-header" data-item="snacks">
                                <label class="spending-checkbox">
                                    <input type="checkbox" id="snacks">
                                    <span>ğŸ« ãŠè“å­</span>
                                </label>
                            </div>
                            <div class="spending-input">
                                <input type="number" class="input-field spending-amount" id="snacks-amount" placeholder="é‡‘é¡" min="0" max="99999">
                                <span class="currency">å††</span>
                            </div>
                        </div>

                        <div class="spending-item">
                            <div class="spending-header" data-item="alcohol">
                                <label class="spending-checkbox">
                                    <input type="checkbox" id="alcohol">
                                    <span>ğŸº ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«</span>
                                </label>
                            </div>
                            <div class="spending-input">
                                <input type="number" class="input-field spending-amount" id="alcohol-amount" placeholder="é‡‘é¡" min="0" max="99999">
                                <span class="currency">å††</span>
                            </div>
                        </div>

                        <div class="spending-item">
                            <div class="spending-header" data-item="cigarettes">
                                <label class="spending-checkbox">
                                    <input type="checkbox" id="cigarettes">
                                    <span>ğŸš¬ ã‚¿ãƒã‚³</span>
                                </label>
                            </div>
                            <div class="spending-input">
                                <input type="number" class="input-field spending-amount" id="cigarettes-amount" placeholder="é‡‘é¡" min="0" max="99999">
                                <span class="currency">å††</span>
                            </div>
                        </div>

                        <div class="spending-item">
                            <div class="spending-header" data-item="others">
                                <label class="spending-checkbox">
                                    <input type="checkbox" id="others">
                                    <span>ğŸ›’ ãã®ä»–</span>
                                </label>
                            </div>
                            <div class="spending-input">
                                <input type="number" class="input-field spending-amount" id="others-amount" placeholder="é‡‘é¡" min="0" max="99999">
                                <span class="currency">å††</span>
                            </div>
                            <input type="text" class="input-field spending-memo" id="others-memo" placeholder="å†…å®¹ã‚’è¨˜éŒ²" maxlength="50">
                        </div>
                    </div>
                    
                    <div class="spending-total">
                        <div class="spending-total-label">ä»Šæ—¥ã®åˆè¨ˆ</div>
                        <div class="spending-total-amount" id="daily-spending-total">0å††</div>
                    </div>
                    
                    <button class="btn-secondary btn-spending" id="save-spending-btn">ğŸ’° å—œå¥½å“å‡ºè²»ã‚’è¨˜éŒ²</button>
                </div>

                <button class="btn-primary" id="save-record-btn">ğŸ’¾ å…¨ã¦ã®è¨˜éŒ²ã‚’ä¿å­˜</button>
            </section>

            <!-- å±¥æ­´ã‚¿ãƒ– -->
            <section class="section" id="history">
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-exercise-days">0</div>
                        <div class="stat-label">é‹å‹•æ—¥æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-massage-days">0</div>
                        <div class="stat-label">ãƒãƒƒã‚µãƒ¼ã‚¸æ—¥æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-study-days">0</div>
                        <div class="stat-label">å‹‰å¼·æ—¥æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-reading-days">0</div>
                        <div class="stat-label">èª­æ›¸æ—¥æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-spending-days">0</div>
                        <div class="stat-label">å‡ºè²»æ—¥æ•°</div>
                    </div>
                </div>

                <!-- é‹å‹•ã®å±¥æ­´ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ’ª é‹å‹•ã®ç´¯è¨ˆå›æ•°</span>
                    </div>
                    
                    <div class="period-tabs">
                        <button class="period-tab active" data-period="week">ä»Šé€±</button>
                        <button class="period-tab" data-period="month">ä»Šæœˆ</button>
                        <button class="period-tab" data-period="year">ä»Šå¹´</button>
                        <button class="period-tab" data-period="all">å…¨æœŸé–“</button>
                    </div>
                    
                    <div class="period-info" id="period-info">
                        ä»Šé€± (æœˆæ›œæ—¥ã€œæ—¥æ›œæ—¥)
                    </div>
                    
                    <div class="exercise-totals">
                        <div class="exercise-total-item">
                            <div class="exercise-icon">ğŸ’ª</div>
                            <div class="exercise-info">
                                <div class="exercise-name">è…•ç«‹ã¦ä¼ã›</div>
                                <div class="exercise-count" id="total-pushups">0å›</div>
                            </div>
                        </div>
                        <div class="exercise-total-item">
                            <div class="exercise-icon">ğŸ”¥</div>
                            <div class="exercise-info">
                                <div class="exercise-name">è…¹ç­‹</div>
                                <div class="exercise-count" id="total-situps">0å›</div>
                            </div>
                        </div>
                        <div class="exercise-total-item">
                            <div class="exercise-icon">ğŸ¦µ</div>
                            <div class="exercise-info">
                                <div class="exercise-name">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</div>
                                <div class="exercise-count" id="total-squats">0å›</div>
                            </div>
                        </div>
                        <div class="exercise-total-item exercise-total-sum">
                            <div class="exercise-icon">ğŸ†</div>
                            <div class="exercise-info">
                                <div class="exercise-name">ç·åˆè¨ˆ</div>
                                <div class="exercise-count" id="total-all-exercises">0å›</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ãƒãƒƒã‚µãƒ¼ã‚¸ã®å±¥æ­´ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ«§ ãƒãƒƒã‚µãƒ¼ã‚¸ã®ç´¯è¨ˆæ™‚é–“</span>
                    </div>
                    
                    <div class="other-totals">
                        <div class="other-total-item">
                            <div class="other-icon">ğŸ«§</div>
                            <div class="other-info">
                                <div class="other-name">ãƒãƒƒã‚µãƒ¼ã‚¸æ™‚é–“</div>
                                <div class="other-count" id="total-massage-time">0åˆ†</div>
                            </div>
                        </div>
                        <div class="other-total-item">
                            <div class="other-icon">ğŸ“…</div>
                            <div class="other-info">
                                <div class="other-name">å®Ÿæ–½æ—¥æ•°</div>
                                <div class="other-count" id="total-massage-days-period">0æ—¥</div>
                            </div>
                        </div>
                        <div class="other-total-item">
                            <div class="other-icon">â±ï¸</div>
                            <div class="other-info">
                                <div class="other-name">å¹³å‡æ™‚é–“/æ—¥</div>
                                <div class="other-count" id="average-massage-time">0åˆ†</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‹‰å¼·ã®å±¥æ­´ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ“š å‹‰å¼·ã®ç´¯è¨ˆæ—¥æ•°</span>
                    </div>
                    
                    <div class="study-totals">
                        <div class="study-total-item">
                            <div class="study-icon">ğŸ‡ºğŸ‡¸</div>
                            <div class="study-info">
                                <div class="study-name">è‹±èª</div>
                                <div class="study-count" id="total-english-days">0æ—¥</div>
                            </div>
                        </div>
                        <div class="study-total-item">
                            <div class="study-icon">ğŸ“Š</div>
                            <div class="study-info">
                                <div class="study-name">ç°¿è¨˜</div>
                                <div class="study-count" id="total-bookkeeping-days">0æ—¥</div>
                            </div>
                        </div>
                        <div class="study-total-item">
                            <div class="study-icon">ğŸ’°</div>
                            <div class="study-info">
                                <div class="study-name">FP</div>
                                <div class="study-count" id="total-fp-days">0æ—¥</div>
                            </div>
                        </div>
                        <div class="study-total-item">
                            <div class="study-icon">ğŸ¤–</div>
                            <div class="study-info">
                                <div class="study-name">AI</div>
                                <div class="study-count" id="total-ai-days">0æ—¥</div>
                            </div>
                        </div>
                        <div class="study-total-item study-total-sum">
                            <div class="study-icon">ğŸ“š</div>
                            <div class="study-info">
                                <div class="study-name">ç·å­¦ç¿’æ—¥æ•°</div>
                                <div class="study-count" id="total-study-days-period">0æ—¥</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- èª­æ›¸ã®å±¥æ­´ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ“– èª­æ›¸ã®ç´¯è¨ˆæ™‚é–“</span>
                    </div>
                    
                    <div class="other-totals">
                        <div class="other-total-item">
                            <div class="other-icon">ğŸ“–</div>
                            <div class="other-info">
                                <div class="other-name">èª­æ›¸æ™‚é–“</div>
                                <div class="other-count" id="total-reading-time">0åˆ†</div>
                            </div>
                        </div>
                        <div class="other-total-item">
                            <div class="other-icon">ğŸ“š</div>
                            <div class="other-info">
                                <div class="other-name">èª­æ›¸æ—¥æ•°</div>
                                <div class="other-count" id="total-reading-days-period">0æ—¥</div>
                            </div>
                        </div>
                        <div class="other-total-item">
                            <div class="other-icon">â±ï¸</div>
                            <div class="other-info">
                                <div class="other-name">å¹³å‡æ™‚é–“/æ—¥</div>
                                <div class="other-count" id="average-reading-time">0åˆ†</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å—œå¥½å“å‡ºè²»ã®å±¥æ­´ -->
                <div class="routine-section">
                    <div class="section-title">
                        <span class="section-name">ğŸ’° å—œå¥½å“ã¸ã®å‡ºè²»</span>
                    </div>
                    
                    <div class="spending-totals">
                        <div class="spending-total-item">
                            <div class="spending-icon">â˜•</div>
                            <div class="spending-info">
                                <div class="spending-name">ã‚³ãƒ¼ãƒ’ãƒ¼</div>
                                <div class="spending-count" id="total-coffee-amount">0å††</div>
                            </div>
                        </div>
                        <div class="spending-total-item">
                            <div class="spending-icon">ğŸ«</div>
                            <div class="spending-info">
                                <div class="spending-name">ãŠè“å­</div>
                                <div class="spending-count" id="total-snacks-amount">0å††</div>
                            </div>
                        </div>
                        <div class="spending-total-item">
                            <div class="spending-icon">ğŸº</div>
                            <div class="spending-info">
                                <div class="spending-name">ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«</div>
                                <div class="spending-count" id="total-alcohol-amount">0å††</div>
                            </div>
                        </div>
                        <div class="spending-total-item">
                            <div class="spending-icon">ğŸš¬</div>
                            <div class="spending-info">
                                <div class="spending-name">ã‚¿ãƒã‚³</div>
                                <div class="spending-count" id="total-cigarettes-amount">0å††</div>
                            </div>
                        </div>
                        <div class="spending-total-item">
                            <div class="spending-icon">ğŸ›’</div>
                            <div class="spending-info">
                                <div class="spending-name">ãã®ä»–</div>
                                <div class="spending-count" id="total-others-amount">0å††</div>
                            </div>
                        </div>
                        <div class="spending-total-item spending-total-sum">
                            <div class="spending-icon">ğŸ’°</div>
                            <div class="spending-info">
                                <div class="spending-name">ç·æ”¯å‡º</div>
                                <div class="spending-count" id="total-all-spending">0å††</div>
                            </div>
                        </div>
                        <div class="spending-summary">
                            <div class="spending-summary-item">
                                <span class="summary-label">å‡ºè²»æ—¥æ•°:</span>
                                <span class="summary-value" id="total-spending-days">0æ—¥</span>
                            </div>
                            <div class="spending-summary-item">
                                <span class="summary-label">å¹³å‡/æ—¥:</span>
                                <span class="summary-value" id="average-daily-spending">0å††</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div class="routine-section">
                    <div class="section-name">ğŸ“… éå»7æ—¥é–“ã®è¨˜éŒ²</div>
                    <div class="calendar-grid" id="weekly-calendar"></div>
                </div>
            </section>

            <!-- è¨­å®šã‚¿ãƒ– -->
            <section class="section" id="settings">
                <div class="settings-section">
                    <div class="settings-title">ğŸ”” ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š</div>
                    <label class="checkbox-item" data-toggle="notification">
                        <input type="checkbox" id="notification-enabled">
                        <span>é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
                    </label>
                    
                    <div class="notification-times">
                        <div class="input-group" style="margin-top: 15px;">
                            <label class="input-label" for="notification-time-1">ğŸŒ… ãƒªãƒã‚¤ãƒ³ãƒ‰æ™‚é–“ 1ï¼ˆæœãƒ»æ˜¼ï¼‰</label>
                            <div class="time-input">
                                <input type="time" class="input-field" id="notification-time-1" value="12:00">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="notification-time-2">ğŸŒ™ ãƒªãƒã‚¤ãƒ³ãƒ‰æ™‚é–“ 2ï¼ˆå¤œï¼‰</label>
                            <div class="time-input">
                                <input type="time" class="input-field" id="notification-time-2" value="20:00">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                    <div class="data-controls">
                        <button class="btn-secondary btn-export" id="export-btn">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                        <button class="btn-secondary btn-import" id="import-btn">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                        <input type="file" class="file-input" id="import-file" accept=".json">
                        <button class="btn-secondary btn-clear" id="clear-btn">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
                    </div>
                </div>

                <button class="btn-primary" id="save-settings-btn">è¨­å®šã‚’ä¿å­˜</button>

                <div class="app-info">
                    <div class="storage-status">
                        <div class="status-indicator" id="storage-indicator"></div>
                        <span id="storage-status">ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ç¢ºèªä¸­...</span>
                    </div>
                    <div>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³è¨˜éŒ²ã‚¢ãƒ—ãƒª v2.8.0</div>
                    <div>æ–°æ©Ÿèƒ½: å—œå¥½å“ã¸ã®å‡ºè²»è¨˜éŒ²ãƒ»ç®¡ç†</div>
                    <div>æœ€çµ‚æ›´æ–°: 2025å¹´6æœˆ16æ—¥</div>
                </div>
            </section>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        'use strict';

        // ===============================
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
        // ===============================
        const CONFIG = {
            VERSION: '2.8.0',
            STORAGE_KEY: 'routineAppData_v2',
            SETTINGS_KEY: 'routineAppSettings_v2',
            
            // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã™ã‚‹å®šæ•°
            SUBJECTS: ['english', 'bookkeeping', 'fp', 'ai'],
            CATEGORIES: ['exercise', 'massage', 'study', 'reading', 'spending'],
            SPENDING_ITEMS: ['coffee', 'snacks', 'alcohol', 'cigarettes', 'others'],
            
            // å…¥åŠ›å€¤ã®åˆ¶é™
            LIMITS: {
                EXERCISE_MAX: 9999,
                TIME_MAX: 999,
                TEXT_MAX: 100,
                MEMO_MAX: 1000,
                SPENDING_MAX: 99999
            },
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
            DEFAULTS: {
                NOTIFICATION_TIME_1: '12:00',
                NOTIFICATION_TIME_2: '20:00',
                NOTIFICATION_ENABLED: false
            }
        };

        // DOMè¦ç´ ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
        const SELECTORS = {
            CONTAINER: '#app-container',
            CURRENT_DATE: '#current-date',
            SAVE_RECORD: '#save-record-btn',
            SAVE_EXERCISE: '#save-exercise-btn',
            SAVE_MASSAGE: '#save-massage-btn',
            SAVE_STUDY: '#save-study-btn',
            SAVE_READING: '#save-reading-btn',
            SAVE_SPENDING: '#save-spending-btn',
            SAVE_SETTINGS: '#save-settings-btn',
            EXPORT: '#export-btn',
            IMPORT: '#import-btn',
            CLEAR: '#clear-btn',
            IMPORT_FILE: '#import-file',
            TOAST: '#toast',
            STORAGE_INDICATOR: '#storage-indicator',
            STORAGE_STATUS: '#storage-status'
        };

        // ===============================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // ===============================
        const Utils = {
            /**
             * æ—¥ä»˜ã‚’YYYY-MM-DDå½¢å¼ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
             */
            formatDate(date) {
                return date.toISOString().split('T')[0];
            },

            /**
             * ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—
             */
            getToday() {
                return this.formatDate(new Date());
            },

            /**
             * æ—¥ä»˜ã‚’æ—¥æœ¬èªå½¢å¼ã§è¡¨ç¤º
             */
            getDateString(date) {
                const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆ${days[date.getDay()]}ï¼‰`;
            },

            /**
             * æ•°å€¤ã®æ¤œè¨¼ã¨æ­£è¦åŒ–
             */
            validateNumber(value, min = 0, max = Infinity) {
                const num = parseInt(value) || 0;
                return Math.max(min, Math.min(max, num));
            },

            /**
             * ãƒ†ã‚­ã‚¹ãƒˆã®æ¤œè¨¼ã¨æ­£è¦åŒ–
             */
            validateText(value, maxLength = Infinity) {
                return String(value || '').trim().substring(0, maxLength);
            },

            /**
             * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
             */
            downloadFile(data, filename, type = 'application/json') {
                const blob = new Blob([data], { type });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            },

            /**
             * ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†
             */
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        };

        // ===============================
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
        // ===============================
        const Storage = {
            /**
             * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒãƒ¼ãƒˆç¢ºèª
             */
            isSupported() {
                try {
                    const test = 'test';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch {
                    return false;
                }
            },

            /**
             * ãƒ‡ãƒ¼ã‚¿ä¿å­˜
             */
            save(key, data) {
                if (!this.isSupported()) return false;
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch {
                    return false;
                }
            },

            /**
             * ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
             */
            load(key) {
                if (!this.isSupported()) return null;
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch {
                    return null;
                }
            },

            /**
             * ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
             */
            remove(key) {
                if (!this.isSupported()) return false;
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch {
                    return false;
                }
            }
        };

        // ===============================
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¯ãƒ©ã‚¹
        // ===============================
        class DataManager {
            constructor() {
                this.reset();
            }

            /**
             * ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
             */
            reset() {
                this.data = {
                    records: {},
                    version: CONFIG.VERSION,
                    lastUpdated: new Date().toISOString()
                };

                this.settings = {
                    notificationEnabled: CONFIG.DEFAULTS.NOTIFICATION_ENABLED,
                    notificationTime1: CONFIG.DEFAULTS.NOTIFICATION_TIME_1,
                    notificationTime2: CONFIG.DEFAULTS.NOTIFICATION_TIME_2,
                    version: CONFIG.VERSION
                };
            }

            /**
             * ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
             */
            load() {
                const savedData = Storage.load(CONFIG.STORAGE_KEY);
                const savedSettings = Storage.load(CONFIG.SETTINGS_KEY);

                if (savedData) {
                    this.data = this.migrateData(savedData);
                }

                if (savedSettings) {
                    this.settings = { ...this.settings, ...savedSettings };
                    this.migrateSettings();
                }

                return Storage.isSupported();
            }

            /**
             * è¨­å®šãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
             */
            migrateSettings() {
                // å¤ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‹ã‚‰ã®ç§»è¡Œå‡¦ç†
                if (this.settings.notificationTime && !this.settings.notificationTime1) {
                    this.settings.notificationTime1 = CONFIG.DEFAULTS.NOTIFICATION_TIME_1;
                    this.settings.notificationTime2 = this.settings.notificationTime;
                    delete this.settings.notificationTime;
                }
                
                this.settings.version = CONFIG.VERSION;
            }

            /**
             * ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
             */
            save() {
                this.data.lastUpdated = new Date().toISOString();
                this.data.version = CONFIG.VERSION;
                
                const dataSuccess = Storage.save(CONFIG.STORAGE_KEY, this.data);
                const settingsSuccess = Storage.save(CONFIG.SETTINGS_KEY, this.settings);
                
                return dataSuccess && settingsSuccess;
            }

            /**
             * ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
             */
            migrateData(oldData) {
                if (oldData.version === CONFIG.VERSION) return oldData;

                const newData = {
                    records: {},
                    version: CONFIG.VERSION,
                    lastUpdated: new Date().toISOString()
                };

                if (oldData.records) {
                    Object.entries(oldData.records).forEach(([date, record]) => {
                        newData.records[date] = this.migrateRecord(record, date);
                    });
                }

                return newData;
            }

            /**
             * å€‹åˆ¥ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç§»è¡Œå‡¦ç†
             */
            migrateRecord(record, date) {
                return {
                    date,
                    exercise: record.exercise || { completed: false, pushups: 0, situps: 0, squats: 0 },
                    massage: record.massage || { completed: false, time: 0 },
                    study: this.migrateStudyData(record.study),
                    reading: record.reading || { completed: false, time: 0, title: '' },
                    spending: this.migrateSpendingData(record.spending)
                };
            }

            /**
             * å‹‰å¼·ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
             */
            migrateStudyData(studyData) {
                return {
                    completed: studyData?.completed || false,
                    english: studyData?.english || false,
                    bookkeeping: studyData?.bookkeeping || false,
                    fp: studyData?.fp || false,
                    ai: studyData?.ai || false,
                    englishMemo: studyData?.englishMemo || studyData?.memo || '',
                    bookkeepingMemo: studyData?.bookkeepingMemo || '',
                    fpMemo: studyData?.fpMemo || '',
                    aiMemo: studyData?.aiMemo || ''
                };
            }

            /**
             * å—œå¥½å“ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
             */
            migrateSpendingData(spendingData) {
                return spendingData || {
                    completed: false,
                    coffee: 0,
                    snacks: 0,
                    alcohol: 0,
                    cigarettes: 0,
                    others: 0,
                    othersMemo: '',
                    total: 0
                };
            }

            /**
             * è¨˜éŒ²ã®ä¿å­˜
             */
            saveRecord(recordData) {
                this.data.records[Utils.getToday()] = recordData;
                return this.save();
            }

            /**
             * ä»Šæ—¥ã®è¨˜éŒ²ã‚’å–å¾—
             */
            getTodayRecord() {
                return this.data.records[Utils.getToday()] || null;
            }

            /**
             * ç¶™ç¶šæ—¥æ•°ã®è¨ˆç®—
             */
            calculateStreak(category) {
                let streak = 0;
                const today = new Date();
                
                for (let i = 0; i < 365; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(checkDate.getDate() - i);
                    const dateStr = Utils.formatDate(checkDate);
                    
                    const record = this.data.records[dateStr];
                    if (record?.[category]?.completed) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            }

            /**
             * çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—
             */
            getStats() {
                const stats = {};
                CONFIG.CATEGORIES.forEach(category => {
                    stats[category] = Object.values(this.data.records)
                        .filter(record => record[category]?.completed).length;
                });
                return stats;
            }

            /**
             * æœŸé–“åˆ¥ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
             */
            getRecordsForPeriod(period) {
                const today = new Date();
                const records = Object.values(this.data.records);

                switch (period) {
                    case 'week':
                        return this.getWeekRecords(today, records);
                    case 'month':
                        return this.getMonthRecords(today, records);
                    case 'year':
                        return this.getYearRecords(today, records);
                    case 'all':
                    default:
                        return records;
                }
            }

            /**
             * ä»Šé€±ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
             */
            getWeekRecords(today, records) {
                const startOfWeek = new Date(today);
                const dayOfWeek = startOfWeek.getDay();
                const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                startOfWeek.setDate(startOfWeek.getDate() - daysToMonday);
                startOfWeek.setHours(0, 0, 0, 0);

                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);
                endOfWeek.setHours(23, 59, 59, 999);

                return records.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= startOfWeek && recordDate <= endOfWeek;
                });
            }

            /**
             * ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
             */
            getMonthRecords(today, records) {
                const year = today.getFullYear();
                const month = today.getMonth();

                return records.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate.getFullYear() === year && recordDate.getMonth() === month;
                });
            }

            /**
             * ä»Šå¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
             */
            getYearRecords(today, records) {
                const year = today.getFullYear();

                return records.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate.getFullYear() === year;
                });
            }

            /**
             * é‹å‹•ã®ç´¯è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—
             */
            getExerciseTotals(period = 'all') {
                const totals = { pushups: 0, situps: 0, squats: 0, total: 0 };
                const records = this.getRecordsForPeriod(period);

                records.forEach(record => {
                    if (record.exercise) {
                        totals.pushups += record.exercise.pushups || 0;
                        totals.situps += record.exercise.situps || 0;
                        totals.squats += record.exercise.squats || 0;
                    }
                });

                totals.total = totals.pushups + totals.situps + totals.squats;
                return totals;
            }

            /**
             * ãƒãƒƒã‚µãƒ¼ã‚¸ã®ç´¯è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—
             */
            getMassageTotals(period = 'all') {
                const records = this.getRecordsForPeriod(period);
                let totalTime = 0;
                let totalDays = 0;

                records.forEach(record => {
                    if (record.massage && record.massage.completed) {
                        totalTime += record.massage.time || 0;
                        totalDays++;
                    }
                });

                const averageTime = totalDays > 0 ? Math.round(totalTime / totalDays) : 0;

                return { totalTime, totalDays, averageTime };
            }

            /**
             * å‹‰å¼·ã®ç´¯è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—
             */
            getStudyTotals(period = 'all') {
                const records = this.getRecordsForPeriod(period);
                const totals = { english: 0, bookkeeping: 0, fp: 0, ai: 0, totalDays: 0 };

                records.forEach(record => {
                    if (record.study) {
                        if (record.study.english) totals.english++;
                        if (record.study.bookkeeping) totals.bookkeeping++;
                        if (record.study.fp) totals.fp++;
                        if (record.study.ai) totals.ai++;
                        if (record.study.completed) totals.totalDays++;
                    }
                });

                return totals;
            }

            /**
             * èª­æ›¸ã®ç´¯è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—
             */
            getReadingTotals(period = 'all') {
                const records = this.getRecordsForPeriod(period);
                let totalTime = 0;
                let totalDays = 0;

                records.forEach(record => {
                    if (record.reading && record.reading.completed) {
                        totalTime += record.reading.time || 0;
                        totalDays++;
                    }
                });

                const averageTime = totalDays > 0 ? Math.round(totalTime / totalDays) : 0;

                return { totalTime, totalDays, averageTime };
            }

            /**
             * å—œå¥½å“å‡ºè²»ã®ç´¯è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—
             */
            getSpendingTotals(period = 'all') {
                const records = this.getRecordsForPeriod(period);
                const totals = {
                    coffee: 0, snacks: 0, alcohol: 0, cigarettes: 0, others: 0,
                    total: 0, totalDays: 0
                };

                records.forEach(record => {
                    if (record.spending && record.spending.completed) {
                        CONFIG.SPENDING_ITEMS.forEach(item => {
                            totals[item] += record.spending[item] || 0;
                        });
                        totals.total += record.spending.total || 0;
                        totals.totalDays++;
                    }
                });

                totals.averageDaily = totals.totalDays > 0 ? Math.round(totals.total / totals.totalDays) : 0;
                return totals;
            }

            /**
             * æœŸé–“æƒ…å ±ã®å–å¾—
             */
            getPeriodInfo(period) {
                const today = new Date();
                
                switch (period) {
                    case 'week':
                        return this.getWeekPeriodInfo(today);
                    case 'month':
                        return `ä»Šæœˆ (${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ)`;
                    case 'year':
                        return `ä»Šå¹´ (${today.getFullYear()}å¹´)`;
                    case 'all':
                    default:
                        return this.getAllPeriodInfo();
                }
            }

            /**
             * ä»Šé€±ã®æœŸé–“æƒ…å ±
             */
            getWeekPeriodInfo(today) {
                const startOfWeek = new Date(today);
                const dayOfWeek = startOfWeek.getDay();
                const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                startOfWeek.setDate(startOfWeek.getDate() - daysToMonday);
                
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);
                
                return `ä»Šé€± (${startOfWeek.getMonth() + 1}/${startOfWeek.getDate()} ã€œ ${endOfWeek.getMonth() + 1}/${endOfWeek.getDate()})`;
            }

            /**
             * å…¨æœŸé–“ã®æƒ…å ±
             */
            getAllPeriodInfo() {
                const allRecords = Object.keys(this.data.records);
                if (allRecords.length === 0) {
                    return 'å…¨æœŸé–“ (è¨˜éŒ²ãªã—)';
                }
                
                const sortedDates = allRecords.sort();
                const firstDate = new Date(sortedDates[0]);
                const lastDate = new Date(sortedDates[sortedDates.length - 1]);
                
                return `å…¨æœŸé–“ (${firstDate.getFullYear()}/${firstDate.getMonth() + 1}/${firstDate.getDate()} ã€œ ${lastDate.getFullYear()}/${lastDate.getMonth() + 1}/${lastDate.getDate()})`;
            }

            /**
             * å…¨ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤
             */
            clear() {
                const success = Storage.remove(CONFIG.STORAGE_KEY) && Storage.remove(CONFIG.SETTINGS_KEY);
                if (success) this.reset();
                return success;
            }
        }

        // ===============================
        // UIç®¡ç†ã‚¯ãƒ©ã‚¹
        // ===============================
        class UIManager {
            constructor() {
                this.currentTab = 'record';
                this.currentPeriod = 'week';
                this.isLoading = false;
                this.elements = {};
                this.cacheElements();
            }

            /**
             * DOMè¦ç´ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
             */
            cacheElements() {
                Object.entries(SELECTORS).forEach(([key, selector]) => {
                    this.elements[key] = document.querySelector(selector);
                });
            }

            /**
             * UIåˆæœŸåŒ–
             */
            init() {
                this.updateCurrentDate();
                this.bindEvents();
            }

            /**
             * ç¾åœ¨ã®æ—¥ä»˜ã‚’æ›´æ–°
             */
            updateCurrentDate() {
                if (this.elements.CURRENT_DATE) {
                    this.elements.CURRENT_DATE.textContent = Utils.getDateString(new Date());
                }
            }

            /**
             * ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
             */
            bindEvents() {
                this.bindTabEvents();
                this.bindCheckboxEvents();
                this.bindSpendingEvents();
                this.bindPeriodEvents();
                this.bindButtonEvents();
            }

            /**
             * ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¤ãƒ™ãƒ³ãƒˆ
             */
            bindTabEvents() {
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showTab(e.target.dataset.tab);
                    });
                });
            }

            /**
             * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆ
             */
            bindCheckboxEvents() {
                // å‹‰å¼·é …ç›®
                CONFIG.SUBJECTS.forEach(subject => {
                    const checkbox = document.getElementById(subject);
                    if (checkbox) {
                        checkbox.addEventListener('change', (e) => {
                            this.updateStudyCheckVisual(subject, e.target.checked);
                        });
                    }

                    // ãƒ©ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯
                    const header = document.querySelector(`[data-subject="${subject}"]`);
                    if (header) {
                        header.addEventListener('click', (e) => {
                            if (e.target.type !== 'checkbox') {
                                e.preventDefault();
                                this.toggleStudyCheck(subject);
                            }
                        });
                    }
                });

                // é€šçŸ¥è¨­å®š
                const notificationCheckbox = document.getElementById('notification-enabled');
                if (notificationCheckbox) {
                    notificationCheckbox.addEventListener('change', (e) => {
                        this.updateNotificationVisual(e.target.checked);
                    });
                }

                const notificationToggle = document.querySelector('[data-toggle="notification"]');
                if (notificationToggle) {
                    notificationToggle.addEventListener('click', (e) => {
                        if (e.target.type !== 'checkbox') {
                            e.preventDefault();
                            this.toggleNotification();
                        }
                    });
                }
            }

            /**
             * å—œå¥½å“é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆ
             */
            bindSpendingEvents() {
                CONFIG.SPENDING_ITEMS.forEach(item => {
                    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
                    const checkbox = document.getElementById(item);
                    if (checkbox) {
                        checkbox.addEventListener('change', (e) => {
                            this.updateSpendingCheckVisual(item, e.target.checked);
                        });
                    }

                    // ãƒ©ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯
                    const header = document.querySelector(`[data-item="${item}"]`);
                    if (header) {
                        header.addEventListener('click', (e) => {
                            if (e.target.type !== 'checkbox') {
                                e.preventDefault();
                                this.toggleSpendingCheck(item);
                            }
                        });
                    }

                    // é‡‘é¡å…¥åŠ›
                    const amountInput = document.getElementById(`${item}-amount`);
                    if (amountInput) {
                        amountInput.addEventListener('input', () => {
                            this.updateDailySpendingTotal();
                        });
                    }
                });
            }

            /**
             * æœŸé–“ã‚¿ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆ
             */
            bindPeriodEvents() {
                document.querySelectorAll('.period-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showPeriod(e.target.dataset.period);
                    });
                });
            }

            /**
             * ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
             */
            bindButtonEvents() {
                const buttonEvents = [
                    ['SAVE_RECORD', () => app.saveRecord()],
                    ['SAVE_EXERCISE', () => app.saveExercise()],
                    ['SAVE_MASSAGE', () => app.saveMassage()],
                    ['SAVE_STUDY', () => app.saveStudy()],
                    ['SAVE_READING', () => app.saveReading()],
                    ['SAVE_SPENDING', () => app.saveSpending()],
                    ['SAVE_SETTINGS', () => app.saveSettings()],
                    ['EXPORT', () => app.exportData()],
                    ['IMPORT', () => app.importData()],
                    ['CLEAR', () => app.clearAllData()]
                ];

                buttonEvents.forEach(([key, handler]) => {
                    if (this.elements[key]) {
                        this.elements[key].addEventListener('click', handler);
                    }
                });

                if (this.elements.IMPORT_FILE) {
                    this.elements.IMPORT_FILE.addEventListener('change', (e) => app.handleImportFile(e));
                }
            }

            /**
             * ã‚¿ãƒ–è¡¨ç¤º
             */
            showTab(tabName) {
                if (this.isLoading || !tabName) return;

                // ã™ã¹ã¦ã®ã‚¿ãƒ–ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));

                // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
                const selectedSection = document.getElementById(tabName);

                if (selectedTab && selectedSection) {
                    selectedTab.classList.add('active');
                    selectedSection.classList.add('active');
                    this.currentTab = tabName;

                    if (tabName === 'history') {
                        this.updateHistory();
                    }
                }
            }

            /**
             * å‹‰å¼·é …ç›®ãƒã‚§ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ
             */
            toggleStudyCheck(subject) {
                const checkbox = document.getElementById(subject);
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    this.updateStudyCheckVisual(subject, checkbox.checked);
                }
            }

            /**
             * å‹‰å¼·é …ç›®ãƒã‚§ãƒƒã‚¯è¡¨ç¤ºæ›´æ–°
             */
            updateStudyCheckVisual(subject, checked) {
                const checkbox = document.getElementById(subject);
                const label = checkbox?.closest('.study-checkbox');
                
                if (checkbox && label) {
                    checkbox.checked = checked;
                    label.classList.toggle('checked', checked);
                }
            }

            /**
             * å—œå¥½å“ãƒã‚§ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ
             */
            toggleSpendingCheck(item) {
                const checkbox = document.getElementById(item);
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    this.updateSpendingCheckVisual(item, checkbox.checked);
                }
            }

            /**
             * å—œå¥½å“ãƒã‚§ãƒƒã‚¯è¡¨ç¤ºæ›´æ–°
             */
            updateSpendingCheckVisual(item, checked) {
                const checkbox = document.getElementById(item);
                const label = checkbox?.closest('.spending-checkbox');
                
                if (checkbox && label) {
                    checkbox.checked = checked;
                    label.classList.toggle('checked', checked);
                }
            }

            /**
             * é€šçŸ¥è¨­å®šåˆ‡ã‚Šæ›¿ãˆ
             */
            toggleNotification() {
                const checkbox = document.getElementById('notification-enabled');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    this.updateNotificationVisual(checkbox.checked);
                }
            }

            /**
             * é€šçŸ¥è¨­å®šè¡¨ç¤ºæ›´æ–°
             */
            updateNotificationVisual(checked) {
                const checkbox = document.getElementById('notification-enabled');
                const item = checkbox?.closest('.checkbox-item');
                
                if (checkbox && item) {
                    checkbox.checked = checked;
                    item.classList.toggle('checked', checked);
                }
            }

            /**
             * ä»Šæ—¥ã®å‡ºè²»åˆè¨ˆã‚’æ›´æ–°
             */
            updateDailySpendingTotal() {
                let total = 0;
                CONFIG.SPENDING_ITEMS.forEach(item => {
                    const amountInput = document.getElementById(`${item}-amount`);
                    if (amountInput) {
                        total += parseInt(amountInput.value) || 0;
                    }
                });

                const totalElement = document.getElementById('daily-spending-total');
                if (totalElement) {
                    totalElement.textContent = `${total.toLocaleString()}å††`;
                }
            }

            /**
             * ä»Šæ—¥ã®è¨˜éŒ²ã‚’UIã«èª­ã¿è¾¼ã¿
             */
            loadTodayRecord(record) {
                if (!record) return;

                // é‹å‹•
                this.setFieldValue('pushups', record.exercise.pushups);
                this.setFieldValue('situps', record.exercise.situps);
                this.setFieldValue('squats', record.exercise.squats);

                // ãƒãƒƒã‚µãƒ¼ã‚¸
                this.setFieldValue('massage-time', record.massage.time);

                // å‹‰å¼·
                CONFIG.SUBJECTS.forEach(subject => {
                    const isChecked = record.study[subject] || false;
                    this.updateStudyCheckVisual(subject, isChecked);
                    this.setFieldValue(`${subject}-memo`, record.study[`${subject}Memo`]);
                });

                // èª­æ›¸
                this.setFieldValue('reading-time', record.reading.time);
                this.setFieldValue('book-title', record.reading.title);

                // å—œå¥½å“
                if (record.spending) {
                    CONFIG.SPENDING_ITEMS.forEach(item => {
                        const hasSpending = (record.spending[item] || 0) > 0;
                        this.updateSpendingCheckVisual(item, hasSpending);
                        this.setFieldValue(`${item}-amount`, record.spending[item]);
                    });
                    this.setFieldValue('others-memo', record.spending.othersMemo);
                }
                
                this.updateDailySpendingTotal();
            }

            /**
             * ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ã®è¨­å®š
             */
            setFieldValue(id, value) {
                const element = document.getElementById(id);
                if (element && value !== undefined && value !== null) {
                    element.value = value === 0 ? '' : value;
                }
            }

            /**
             * è¨­å®šã‚’UIã«èª­ã¿è¾¼ã¿
             */
            loadSettings(settings) {
                const notificationTime1 = document.getElementById('notification-time-1');
                const notificationTime2 = document.getElementById('notification-time-2');
                
                if (notificationTime1) {
                    notificationTime1.value = settings.notificationTime1 || CONFIG.DEFAULTS.NOTIFICATION_TIME_1;
                }
                if (notificationTime2) {
                    notificationTime2.value = settings.notificationTime2 || CONFIG.DEFAULTS.NOTIFICATION_TIME_2;
                }
                
                this.updateNotificationVisual(settings.notificationEnabled);
            }

            /**
             * ç¶™ç¶šæ—¥æ•°ã®æ›´æ–°
             */
            updateStreaks(streaks) {
                Object.entries(streaks).forEach(([category, count]) => {
                    const elementId = category === 'spending' ? 'spending-streak' : `${category}-streak`;
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = `${count}æ—¥ç¶™ç¶š`;
                    }
                });
            }

            /**
             * å±¥æ­´å…¨ä½“ã®æ›´æ–°
             */
            updateHistory() {
                this.updateStats();
                this.updatePeriodInfo();
                this.updateExerciseTotals();
                this.updateMassageTotals();
                this.updateStudyTotals();
                this.updateReadingTotals();
                this.updateSpendingTotals();
                this.updateCalendar();
            }

            /**
             * çµ±è¨ˆã®æ›´æ–°
             */
            updateStats() {
                const stats = app.dataManager.getStats();
                Object.entries(stats).forEach(([category, count]) => {
                    const element = document.getElementById(`total-${category}-days`);
                    if (element) {
                        element.textContent = count;
                    }
                });
            }

            /**
             * æœŸé–“è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
             */
            showPeriod(period) {
                if (this.isLoading || !period) return;

                this.currentPeriod = period;

                // æœŸé–“ã‚¿ãƒ–ã®æ›´æ–°
                document.querySelectorAll('.period-tab').forEach(tab => tab.classList.remove('active'));
                const selectedTab = document.querySelector(`[data-period="${period}"]`);
                if (selectedTab) {
                    selectedTab.classList.add('active');
                }

                // ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
                this.updatePeriodInfo();
                this.updateExerciseTotals();
                this.updateMassageTotals();
                this.updateStudyTotals();
                this.updateReadingTotals();
                this.updateSpendingTotals();
            }

            /**
             * æœŸé–“æƒ…å ±ã®æ›´æ–°
             */
            updatePeriodInfo() {
                const periodInfo = app.dataManager.getPeriodInfo(this.currentPeriod);
                const element = document.getElementById('period-info');
                if (element) {
                    element.textContent = periodInfo;
                }
            }

            /**
             * é‹å‹•å±¥æ­´ã®æ›´æ–°
             */
            updateExerciseTotals() {
                const totals = app.dataManager.getExerciseTotals(this.currentPeriod);
                
                const elements = {
                    pushups: document.getElementById('total-pushups'),
                    situps: document.getElementById('total-situps'),
                    squats: document.getElementById('total-squats'),
                    total: document.getElementById('total-all-exercises')
                };

                Object.entries(elements).forEach(([key, element]) => {
                    if (element) {
                        element.textContent = `${totals[key].toLocaleString()}å›`;
                    }
                });
            }

            /**
             * ãƒãƒƒã‚µãƒ¼ã‚¸å±¥æ­´ã®æ›´æ–°
             */
            updateMassageTotals() {
                const totals = app.dataManager.getMassageTotals(this.currentPeriod);
                
                this.updateElement('total-massage-time', `${totals.totalTime.toLocaleString()}åˆ†`);
                this.updateElement('total-massage-days-period', `${totals.totalDays}æ—¥`);
                this.updateElement('average-massage-time', `${totals.averageTime}åˆ†`);
            }

            /**
             * å‹‰å¼·å±¥æ­´ã®æ›´æ–°
             */
            updateStudyTotals() {
                const totals = app.dataManager.getStudyTotals(this.currentPeriod);
                
                const elements = ['english', 'bookkeeping', 'fp', 'ai'];
                elements.forEach(subject => {
                    this.updateElement(`total-${subject}-days`, `${totals[subject]}æ—¥`);
                });
                this.updateElement('total-study-days-period', `${totals.totalDays}æ—¥`);
            }

            /**
             * èª­æ›¸å±¥æ­´ã®æ›´æ–°
             */
            updateReadingTotals() {
                const totals = app.dataManager.getReadingTotals(this.currentPeriod);
                
                this.updateElement('total-reading-time', `${totals.totalTime.toLocaleString()}åˆ†`);
                this.updateElement('total-reading-days-period', `${totals.totalDays}æ—¥`);
                this.updateElement('average-reading-time', `${totals.averageTime}åˆ†`);
            }

            /**
             * å—œå¥½å“å±¥æ­´ã®æ›´æ–°
             */
            updateSpendingTotals() {
                const totals = app.dataManager.getSpendingTotals(this.currentPeriod);
                
                CONFIG.SPENDING_ITEMS.forEach(item => {
                    this.updateElement(`total-${item}-amount`, `${totals[item].toLocaleString()}å††`);
                });
                
                this.updateElement('total-all-spending', `${totals.total.toLocaleString()}å††`);
                this.updateElement('total-spending-days', `${totals.totalDays}æ—¥`);
                this.updateElement('average-daily-spending', `${totals.averageDaily.toLocaleString()}å††`);
            }

            /**
             * è¦ç´ ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
             */
            updateElement(id, text) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = text;
                }
            }

            /**
             * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ›´æ–°
             */
            updateCalendar() {
                const calendar = document.getElementById('weekly-calendar');
                if (!calendar) return;

                calendar.innerHTML = '';

                // ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 
                const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                days.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day calendar-header';
                    dayElement.textContent = day;
                    calendar.appendChild(dayElement);
                });

                // éå»7æ—¥é–“ã®æ—¥ä»˜è¿½åŠ 
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = Utils.formatDate(date);
                    const record = app.dataManager.data.records[dateStr];

                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day calendar-date';

                    if (i === 0) {
                        dayElement.classList.add('today');
                    } else if (record && CONFIG.CATEGORIES.some(cat => record[cat]?.completed)) {
                        dayElement.classList.add('completed');
                    }

                    dayElement.textContent = date.getDate();
                    calendar.appendChild(dayElement);
                }
            }

            /**
             * ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ã®æ›´æ–°
             */
            updateStorageStatus(isWorking) {
                if (this.elements.STORAGE_INDICATOR && this.elements.STORAGE_STATUS) {
                    this.elements.STORAGE_INDICATOR.className = `status-indicator ${isWorking ? '' : 'error'}`;
                    this.elements.STORAGE_STATUS.textContent = isWorking ? 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜: æœ‰åŠ¹' : 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ç„¡åŠ¹';
                }
            }

            /**
             * ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¨­å®š
             */
            setLoading(isLoading) {
                this.isLoading = isLoading;
                const container = this.elements.CONTAINER;
                const buttons = document.querySelectorAll('button:not(.nav-tab)');

                if (container) {
                    container.classList.toggle('loading', isLoading);
                }

                buttons.forEach(btn => {
                    btn.disabled = isLoading;
                });
            }

            /**
             * ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
             */
            showToast(message, type = 'success') {
                const toast = this.elements.TOAST;
                if (!toast) return;

                toast.textContent = message;
                toast.className = `toast ${type === 'error' ? 'error' : ''}`;
                toast.style.display = 'block';

                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        }

        // ===============================
        // é€šçŸ¥ç®¡ç†ã‚¯ãƒ©ã‚¹
        // ===============================
        class NotificationManager {
            constructor() {
                this.timers = [];
            }

            /**
             * é€šçŸ¥è¨±å¯ã®è¦æ±‚
             */
            async requestPermission() {
                if (!('Notification' in window)) return false;
                
                if (Notification.permission === 'default') {
                    const permission = await Notification.requestPermission();
                    return permission === 'granted';
                }
                
                return Notification.permission === 'granted';
            }

            /**
             * é€šçŸ¥è¨­å®š
             */
            setup(settings) {
                this.clear();
                
                if (!settings.notificationEnabled || !('Notification' in window)) return;
                if (Notification.permission !== 'granted') return;

                // é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
                if (settings.notificationTime1) {
                    this.schedule(settings.notificationTime1, 'ğŸŒ… æœã®ãƒªãƒã‚¤ãƒ³ãƒ‰');
                }
                if (settings.notificationTime2) {
                    this.schedule(settings.notificationTime2, 'ğŸŒ™ å¤œã®ãƒªãƒã‚¤ãƒ³ãƒ‰');
                }
            }

            /**
             * é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
             */
            schedule(timeString, label) {
                const [hours, minutes] = timeString.split(':').map(Number);
                const now = new Date();
                const notificationTime = new Date();
                notificationTime.setHours(hours, minutes, 0, 0);

                if (notificationTime <= now) {
                    notificationTime.setDate(notificationTime.getDate() + 1);
                }

                const delay = notificationTime.getTime() - now.getTime();

                const timer = setTimeout(() => {
                    this.show(label);
                    this.schedule(timeString, label); // 24æ™‚é–“å¾Œã«å†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
                }, delay);

                this.timers.push(timer);
            }

            /**
             * é€šçŸ¥ã®è¡¨ç¤º
             */
            show(label = '') {
                if (Notification
